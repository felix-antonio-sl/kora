# KODA Knowledge Artifact: Categorical Query Language (CQL) Data Integration
# Domain: Category Theory / Scientific Data Integration

_manifest:
  urn: "urn:knowledge:koda:cat:cql-data-integration:1.0.0"
  federation:
    visibility: internal
    license: "CC-BY-4.0"
  compatibility:
    min_consumer_version: "1.0.0"
    breaking_changes_from: null
  resolution:
    canonical_url: "file://knowledge/domains/cat/integration/cql_data_integration.koda.yml"
    mirrors: []
  dependencies:
    requires:
      - urn: "urn:knowledge:koda:core:spec:1.0.0"
  provenance:
    created_by: "FS"
    created_at: "2025-12-05"
    last_modified_by: "FS"
    last_modified_at: "2025-12-14"
    signature: null

ID: CAT-CQL-01
Version: 1.0.0
Status: Active
Human-Creator: FS
Human-Editor: FS
Model-Collaborator: Cascade
Creation-Date: 2025-12-05
Modification-Date: 2025-12-14
Version-Notes: "Initial KODA/Spec skeleton for CQL data integration. Updated with full MEAT+skeleton from sources/cat/Categorical Data Integration for Computational Science.md."
Src:
  - "file://sources/cat/Categorical Data Integration for Computational Science.md"
Ctx: "Notas estructuradas sobre CQL, migración funtorial y manejo de heterogeneidad científica."

LLM_Parsing_Instructions:
  ID: KODA-LLM-PARSER-01
  Req: Mandatory block following Metadata.
  Prohib: Using for artifact creation or translation.
  Content: |
    BEGIN_LLM_INSTRUCTIONS
    You are an AI agent consuming a KODA artifact. Parse with absolute fidelity.

    FIDELITY: Preserve meat (essential information) and skeleton (structure: headers, IDs, lists, tables) with zero loss. Ignore fat (filler words, rhetoric, stylistic prose).

    LEXICON (expand before processing): Act->Action, Cond->Condition, Ctx->Context, Ctx_Required->Required External Reference, Ctx_Optional->Optional External Reference, Def->Definition, Ex->Example, Mssn->Mission, Obj->Objective, Proc->Process, Purp->Purpose, Ref->Reference, XRef->Cross-Artifact Reference, XRef_Required->Mandatory Cross-Artifact Reference, Req->Requirement, Res->Result, Src->Source, Prohib->Prohibition, Warn->Warning, Just->Justification, Rec->Recommendation

    REFERENCE POLICY: Ref: is internal only—must point to existing ID within THIS document. XRef/XRef_Required: are external only—must point to a URN (optionally with #ID fragment) in another artifact. External documents without specific ID use Ctx:, Ctx_Required:, or Ctx_Optional:.

    LANGUAGE POLICY: Keywords in English, content in original language. Never translate content.
    END_LLM_INSTRUCTIONS

Purp: "Registrar el lenguaje CQL como herramienta para integración de datos basada en CT."
Obj: "Servir de fuente formal para CM-MIGRATION-ENGINE y CM-INTEGRATION-ENGINE en dominios científicos."

Source:
  Title: "Categorical Data Integration for Computational Science"
  Authors: ["Kristopher Brown", "David I. Spivak", "Ryan Wisnesky"]
  Date: "March 27, 2019"
  Keywords:
    - "Data integration"
    - "data migration"
    - "heterogeneous data"
    - "category theory"
    - "machine learning"
    - "density functional theory"
  Ctx: "Categorical Query Language (CQL) as an open-source query and data integration scripting language applied to computational science data sharing and integration."

Abstract:
  ID: CQL-ABS-01
  Def: "Categorical Query Language is an open-source query and data integration scripting language that can be applied to common challenges in the field of computational science. We discuss how the structure-preserving nature of CQL data migrations protect those who publicly share data from the misinterpretation of their data. Likewise, this feature of CQL migrations allows those who draw from public data sources to be sure only data which meets their specification will actually be transferred. We argue some open problems in the field of data sharing in computational science are addressable by working within this paradigm of functorial data migration. We demonstrate these tools by integrating data from the Open Quantum Materials Database with some alternative materials databases."

Background:
  ID: CQL-BG-01

  Categorical_Query_Language:
    ID: CQL-BG-1-1
    Content: |
      Categorical Query Language (CQL) is based on an algebraic database formalism motivated by category theory [SSCW16], which describes databases as sets of equations, distinct from the other data models (relational, RDF, graph, LINQ).

      This formalism is based on a principled theory for data integration and, in particular, facilitates static guarantees of data integrity enforcement using a rich language for constraints, provides complete provenance for all transformations, and seamlessly integrates programming languages into the schema.

      Data integration will be taken to mean the combination of two database instances with different schemas into a coherent unified schema and instance. The migration of data from one schema into another and even the simple and common act of querying a given database are specific cases of this [SW16].

      Algebraic databases have been used to integrate financial data, health records, and manufacturing service databases [WBJ+17]. Furthermore, the representation of materials science knowledge within category-theoretic data structures has enabled novel analyses of materials [SGWB11, BGSB15]. These are particularly amenable to describing connections between first principles and emergent properties in systems with many hierarchical scales (other disciplines that have benefited from these tools include physics, linguistics, and computer science [Sic06]).

      In this paper, we consider the application of algebraic data integration to computational science more broadly.

  Data_Sharing:
    ID: CQL-BG-1-2
    Content: |
      In a 2015 Viewpoint on data sharing [Kit15], Kitchin identifies tables and figures in manuscripts to be the current standard for communicating data in scientific research. The flexibility of this medium is achieved at the cost of machine readability and re-usability.

      Data is too broad of a concept to allow for a satisfactory centralized database, thus in most circumstances researchers who share structured data must independently release it in some personalized format.

      Heterogeneity in data formats leads to challenges, however. A review on academic data sharing practices revealed that a large concern that prevents sharing is the fear of data being misinterpreted and the work needed to address questions and concerns of the data receivers. Furthermore, the reliance of unstructured metadata was also cited as a problem that hindered the usability of shared data [FFH15].

      Guidelines have been called for to ease this process: a 2016 review of data sharing in computational science [JPC16] outlined the field’s future challenges: addressing the lack of structured data, tools to combine information from disparate datasets, and communication of the nuances of data sets.

      Although no systems safeguard against fundamentally misunderstanding the domain being modeled by some database, data misuse can be mitigated by leveraging the additional features of a CQL schema not present in SQL schemas.

      CQL schemas are structurally equivalent to ontology logs (ologs) [SK12]. Ologs are like "concept maps" that have a formal interpretation. Boxes can be interpreted as database tables with arrows as foreign keys, or alternatively as sets with arrows as functions.

      They can express nontrivial facts because they are equipped with equations stating when two paths must yield the same result. Thus, a CQL schema is not merely a container for information but itself conveys important conceptual knowledge and can distinguish sensible from nonsensical instance data.

      These path equations communicate higher-level meaning to those who view the database and also serve as data-integrity constraints for any instance data that is stored in the schema, which helps prevent a large class of data misuse errors in two ways.

      Firstly, there is a static guarantee that data represented in an algebraic database cannot violate these constraints. Thus, a researcher with a particular frame of reference can safely draw data from external sources without worrying that the new data violates their data integrity constraints.

      Secondly, CQL transformations come from the paradigm of functorial data migration [Spi12], meaning they are structure-preserving in both the source and target schemas. This protects those who share data, which can only be migrated in a way that respects the rules that accompany the source schema.

      Without these abstractions, users must write scripts to perform data migrations by directly manipulating databases with raw SQL, which is error-prone as well as fragile to changes in source or target schema specifications.

      This property is important for practical applications because the general problem of checking if an arbitrary schema mapping preserves constraints is undecidable and requires an automated theorem prover.

  Computational_Science:
    ID: CQL-BG-1-3
    Content: |
      Simulation now serves as a complementary tool of scientific inquiry, alongside theory and experiment.

      As a case study, we consider Density Functional Theory (DFT), a popular tool for materials scientists which enables the efficient prediction of electronic properties (such as stability) from a chemical structure input [Bur12]. Databases of computational data benefit the public in many ways [JPC16]:

      1. to aid and inspire further computational studies
      2. to establish reference against which to compare results
      3. to facilitate property prediction and materials screening

      Data sharing can greatly accelerate the rate of research, as high-quality data is expensive to generate. However, there are few domains in which widely-accepted standards for data sharing exist.

      Although there are many standardized formats for representing chemical structures [OBJ+11], there are no such standards for more complicated entities such as the symmetry analysis of a structure, the pseudopotentials used in DFT calculation, density of states data resulting from a DFT calculation, and the DFT calculation itself.

      A quantum chemistry dataset can be considered as a container for many DFT calculations. Each calculation can involve multiple structures in addition to having a large number of parameters and metadata; there is no standard format for storing data at this higher level of abstraction.

      This is compounded by the fact that the meaning of a "calculation" is not something well-defined: even if one fixes the software package which implements DFT and its required input parameters, in practice DFT gets called by arbitrary scripts which do nontrivial sequences of commands as well as on-the-fly data preprocessing and postprocessing. Thus a DFT calculation has no a priori restrictions on what its inputs or outputs might be.

      Furthermore, many questions of interest depend not on a single calculation, but rather on ensembles of calculations, grouped in particular ways.

      For example, one is often interested in formation energies, i.e., a structure’s energy relative to some reference energy, which depends on some arbitrarily-chosen mapping of its constituent elements to reference species, as well as the calculations for those reference species.

      For this to be valid, those calculations ought to be done at similar (though usually not exact) DFT settings.

      In practice, scientists can only communicate structured raw data in tiny fragments (e.g., specific chemical structures) of the systems they try to model, which contain concepts at higher levels of abstraction such as chemical species, reaction mechanisms, and reaction networks.

      The ability to freely exchange structured data at the level of abstraction which scientists actually work at would support many scientific activities such as machine learning applications which thrive on large datasets, straightforward testing of results for reproducibility, and avoiding duplication of computational effort.

      This perspective will only consider the integration of relational databases, which have a well-defined structure to their data. There are important trade-offs to consider between the relational data model and alternatives (most prominently, MongoDB).

      OQMD [KSM+15] is the only major materials database that currently is relational, in contrast to the Materials Project [JOH+13], Inorganic Crystal Structure Database (ICSD) [Hel14], and NOMAD [GCL+16] databases.

Case_Studies:
  ID: CQL-CS-01

  Overview:
    ID: CQL-CS-2-1
    Def: "We consider two problems: data migration and data integration. In addition to OQMD, we consider a representative materials database called Catalysis, with a rich schema structure that encodes information in a different way from OQMD."
    Actions:
      - "migrate OQMD -> Catalysis (resulting instance has the same schema as Catalysis and data from both databases)"
      - "merge OQMD and Catalysis into a new schema that includes overlapping and non-overlapping content of both databases"
    Questions:
      - "What tables / paths correspond to the same meaning? overlap.py Section 1.1"
      - "What functions, if any, are required to translate between two representations of data with the same meaning (e.g., unit conversion, formatting)? javafuncs.py"
      - "Are there any attributes which are not explicitly represented (describable as a constant or a function of other attributes in the database)? Choose whether to compute these attributes in SQL while landing data into CQL or compute them within CQL itself (overlap.py Section 3)."
      - "If we only want to consider some subset of records in a database, what filters should be applied?"
      - "What is sufficient for two records to be considered the same despite being represented differently in the two different databases?"

CQL_Overview:
  - ID: CQL-DEF
    Def: "CQL = Categorical Query Language, an open-source query and data integration scripting language based on an algebraic database formalism motivated by category theory."
    Properties:
      - "Static guarantees of data integrity enforcement using a rich language for constraints."
      - "Complete provenance for all transformations."
      - "Seamlessly integrates programming languages into the schema."
    Use: "Integrar bases de datos científicas complejas de forma robusta."

  - ID: CQL-SCHEMA
    Def: "Esquema CQL = Olog (ontology log) que captura conocimiento conceptual explícito."
    Interpretation: "El esquema impone significado semántico, evitando mal uso de datos."
    Ref: CQL-DEF

Functorial_Migration:
  - ID: CQL-MIGRATION
    Def: "Migración en CQL = aplicación de Δ/Σ/Π inducida por un funtor de esquemas F: S_source→S_target."
    Guarantee: "Correctness by construction: si el funtor existe, la migración respeta integridad y constraints."
    Note: "CQL transformations come from the paradigm of functorial data migration, meaning they are structure-preserving in both the source and target schemas."
    XRef:
      - "urn:knowledge:koda:cat:seven-sketches:1.0.0#MIGRATION-DELTA"
      - "urn:knowledge:koda:cat:seven-sketches:1.0.0#MIGRATION-SIGMA"
      - "urn:knowledge:koda:cat:seven-sketches:1.0.0#MIGRATION-PI"
    Proc: |
      1. Definir esquema fuente S_source como categoría (ologs CQL).
      2. Definir esquema destino S_target.
      3. Construir funtor F: S_source → S_target que capture la traducción.
      4. CQL genera automáticamente Δ_F, Σ_F, Π_F.
      5. Aplicar el operador adecuado según el tipo de migración.
      6. CQL garantiza correctness + provenance automático.

  - ID: CQL-PROVENANCE
    Def: "Provenance = trazabilidad automática del origen de cada dato migrado."
    Mechanism: "La funtorialidad preserva información sobre el origen en cada transformación."
    Use: "Auditar pipelines de integración científica y justificar resultados."

Heterogeneity_Handling:
  - ID: CQL-HETEROGENEITY-FACTORS
    Def: "Factores típicos de heterogeneidad en datos científicos."
    Factors:
      - "Nombres diferentes para conceptos iguales."
      - "Constantes implícitas no documentadas."
      - "Denormalización y duplicación de información."
      - "Estructura oculta en campos tipo string."
      - "Diferentes niveles de granularidad entre fuentes."
      - "Uso de labelled nulls para representar valores distintos (pero desconocidos)."
    Ref: CQL-DEF

  - ID: CQL-HETEROGENEITY-NOTES
    Def: "Notas concretas de heterogeneidad + mitigaciones descritas en los case studies."
    Notes:
      - "Differing names: mapping of names can be directly specified (overlap.py Section 1.2)."
      - "Implicit constants: declare database-wide constants during migration (example: every OQMD calculation uses VASP)."
      - "Degree of denormalization: map attributes to paths (e.g., Structures.x0 -> Structure.cell_id.x0) and, conversely, unpack JSON fields via functions."
      - "Hidden structure: JSON attributes (e.g., params) require functions to access specific parameters."
      - "Different levels of granularity: migrate low->high by leaving attributes as NULLs (or a chosen value); high->low by ignoring excess attributes/foreign keys."
      - "In contrast to SQL, CQL uses labelled nulls: distinct (but unknown) values that behave like variables and can participate in functions and constraints."

  - ID: CQL-HETEROGENEITY-SOLUTION
    Def: "Solución CQL: definir funtores de traducción F: S_source→S_target que capturen explícitamente las correspondencias."
    Use: "Eliminar ambigüedad semántica al alinear esquemas heterogéneos."
    Ref: CQL-MIGRATION

Future_Outlook:
  ID: CQL-FUTURE-01
  Content: |
    The example databases from this study only considered bulk materials, which are comparatively simple relative to surfaces.

    Surface DFT models have many practical applications yet also involve more complicated relations between calculations and structures.

    We plan to demonstrate the utility of the algebraic data integration with CQL in surface science.

    Considering a broader outlook, this perspective focused on materials science and DFT, yet the tools are equally applicable to other scientific fields.

    For example, life sciences research broadly speaking lacks widespread data standardization, and survey results have identified an urgent need for "user-friendly tools targeting integration of heterogeneous datasets" [GCAM+14].

Conclusion:
  ID: CQL-CONC-01
  Content: |
    The lack of a robust method for moving data between complex schemas has discouraged the sharing of data.

    We demonstrate that CQL offers an intuitive language for precisely specifying the translation between different structured data representations, thus expanding the usefulness of structured data and facilitating precise communication between researchers with different frames of reference.

    This has been demonstrated with data migration and data integration examples for a real-world problem from computational materials science.

    Open problems in data sharing have been summarized as the lack of:
    1. structured data,
    2. tools to combine information from disparate datasets, and
    3. communication of the nuances of data sets.

Declaration_of_Interest:
  ID: CQL-DECL-01
  Content: |
    KB was supported by the Department of Defense (DoD) through the National Defense Science & Engineering Graduate Fellowship (NDSEG) Program.

    RW and DS are consulting members for Categorical Informatics, which offers consultation services for CQL usage.

    The authors would like to thank Michael Statt from Stanford University and Joseph Montoya from Toyota Research Institute for constructive criticism of the manuscript.

Data_Availability:
  ID: CQL-DATA-01
  Url: "https://github.com/kris-brown/cql_data_integration"


