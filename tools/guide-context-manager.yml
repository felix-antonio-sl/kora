_manifest:
  urn: "urn:kora:doc:guide-context-manager:3.0.0"
  federation:
    visibility: private
    license: "CC-BY-4.0"
  compatibility:
    min_consumer_version: "1.0.0"
    breaking_changes_from: null
  resolution:
    canonical_url: "file://knowledge/domains/google_antigravity/guide_ag_003_context-manager_koda.yml"
    mirrors: []
  dependencies:
    requires:
      - urn: "urn:kora:kb:spec:1.0.0"
        reason: "KODA/Spec base"
      - urn: "urn:kora:kb:transform:1.0.0"
        reason: "KODA transformation methodology"
  provenance:
    created_by: "FS"
    created_at: "2026-01-20"
    last_modified_by: "GPT-5.2 (KODA-TRANSFORMER)"
    last_modified_at: "2026-01-20"
    signature: null

ID: GUIDE-AG-CONTEXT-MANAGER-03
Version: 3.0.0
Status: Draft
Human-Creator: "FS"
Human-Editor: "GPT-5.2 (KODA-TRANSFORMER)"
Model-Collaborator: "GPT-5.2"
Creation-Date: 2026-01-20
Modification-Date: 2026-01-20
Source: "staging/manual_context_manager.md"
Ctx: "Sistema de gestiÃ³n de contexto (snapshots, handoffs, dominio.md) para optimizar ventana de contexto y transiciones de sesiÃ³n."
Version-Notes: "Transformado desde Markdown a KODA/Spec (telegraphic + dedup)."

LLM_Parsing_Instructions:
  ID: KODA-LLM-PARSER-01
  Req: Mandatory block following Metadata.
  Prohib: Using for artifact creation or translation.
  Content: |
    BEGIN_LLM_INSTRUCTIONS
    You are an AI agent consuming a KODA artifact. Parse with absolute fidelity.

    FIDELITY: Preserve meat (essential information) and skeleton (structure: headers, IDs, lists, tables) with zero loss. Ignore fat (filler words, rhetoric, stylistic prose).

    LEXICON (expand before processing): Act->Action, Cond->Condition, Ctx->Context, Ctx_Required->Required External Reference, Ctx_Optional->Optional External Reference, Def->Definition, Ex->Example, Mssn->Mission, Obj->Objective, Proc->Process, Purp->Purpose, Ref->Reference, XRef->Cross-Artifact Reference, XRef_Required->Mandatory Cross-Artifact Reference, Req->Requirement, Res->Result, Src->Source, Prohib->Prohibition, Warn->Warning, Just->Justification, Rec->Recommendation

    REFERENCE POLICY: Ref: is internal onlyâ€”must point to existing ID within THIS document. XRef/XRef_Required: are external onlyâ€”must point to a URN (optionally with #ID fragment) in another artifact. External documents without specific ID use Ctx:, Ctx_Required:, or Ctx_Optional:.

    LANGUAGE POLICY: Keywords in English, content in original language. Never translate content.
    END_LLM_INSTRUCTIONS

Purp: "Optimizar ventana de contexto y mejorar transiciones entre sesiones."
Obj:
  - "Reducir olvido/repeticiÃ³n en sesiones largas mediante snapshots periÃ³dicos."
  - "Habilitar continuidad entre sesiones mediante handoffs estructurados."
  - "Evitar conocimiento disperso mediante esqueleto semÃ¡ntico y `dominio.md`."

Definitions:
  - ID: DEF-SNAPSHOT
    Def: "Snapshot: captura del estado mental con esqueleto poblado de conocimiento."
  - ID: DEF-HANDOFF
    Def: "Handoff: paquete de transferencia para continuar en otra sesiÃ³n."
  - ID: DEF-DOMINIO-MD
    Def: "`dominio.md`: conocimiento permanente del proyecto (stakeholders, glosario, arquitectura)."
  - ID: DEF-ESQUELETO
    Def: "Esqueleto (semÃ¡ntico): estructura/punteros para organizar conocimiento y referencias a secciones/archivos."
  - ID: DEF-SESIÃ“N-INICIAR
    Def: "Comando: `/sesion iniciar` (crea sesiÃ³n y carga contexto base)."
  - ID: DEF-SESIÃ“N-INICIAR-CONTINUAR
    Def: "Comando: `/sesion iniciar --continuar {id}` (reanuda una sesiÃ³n desde su handoff)."
  - ID: DEF-SESIÃ“N-CERRAR
    Def: "Comando: `/sesion cerrar` (consolida snapshots y genera handoff)."
  - ID: DEF-SESIÃ“N-ESTADO
    Def: "Comando: `/sesion estado` (lista Ãºltimas sesiones)."
  - ID: DEF-EXTRACCION-CORPUS
    Def: "Comando: `/extraccion-corpus` (genera esqueleto de documento extenso y lo integra en el snapshot activo)."

Why_This_System:
  ID: CTX-MGR-WHY-01
  Purp: "MotivaciÃ³n: problemas tÃ­picos y mitigaciones."
  Problems:
    - Problem: "SesiÃ³n larga"
      Symptom: "Agente olvida/repite"
      Solution: "Snapshots periÃ³dicos"
    - Problem: "TransiciÃ³n sin contexto"
      Symptom: "Nueva sesiÃ³n sin memoria"
      Solution: "Handoffs estructurados"
    - Problem: "Conocimiento disperso"
      Symptom: "Archivos sin organizar"
      Solution: "Esqueleto semÃ¡ntico"

Key_Concepts:
  ID: CTX-MGR-CONCEPTS-01

  Snapshot:
    Ref: DEF-SNAPSHOT
    Template_Example: |
      ```markdown
      # Snapshot: 2026-01-19T12:00

      ## Objetivo Activo
      DiseÃ±ar API de autenticaciÃ³n

      ## Esqueleto de Conocimiento
      ğŸ“ Archivos Consultados
      â”œâ”€â”€ ğŸ“„ auth_spec.md
      â”‚   â””â”€â”€ Â§2.1 JWT Tokens â†’ "Usar RS256 para firma"
      â””â”€â”€ ğŸ“„ security_policy.md
          â””â”€â”€ Â§3 ExpiraciÃ³n â†’ "Token vÃ¡lido 1h"

      ## Decisiones Tomadas
      | DecisiÃ³n | RazÃ³n                     |
      | :------- | :------------------------ |
      | RS256    | Mayor seguridad que HS256 |
      ```

  Handoff:
    Ref: DEF-HANDOFF

  Dominio_File:
    Ref: DEF-DOMINIO-MD

Workflow:
  ID: CTX-MGR-WORKFLOW-01
  Proc:
    - Step: "INICIAR SESIÃ“N"
      Ref: DEF-SESIÃ“N-INICIAR
      Res:
        - "Crea directorio en `~/.gemini/antigravity/sesiones/`."
        - "Lee `dominio.md` si existe."
    - Step: "TRABAJAR"
      Act:
        - 'Crear snapshot: "Crea un snapshot" (captura estado actual).'
        - Ref: DEF-EXTRACCION-CORPUS
        - "Trabajo normal: skill monitorea saturaciÃ³n."
    - Step: "CERRAR SESIÃ“N"
      Ref: DEF-SESIÃ“N-CERRAR
      Res:
        - "Consolida snapshots en `_handoff.md`."
        - "Genera prÃ³ximos pasos."
    - Step: "CONTINUAR DESPUÃ‰S"
      Ref: DEF-SESIÃ“N-INICIAR-CONTINUAR
      Res:
        - "Lee `_handoff.md`."
        - "Restaura esqueleto de conocimiento."

Usage_Examples:
  ID: CTX-MGR-EXAMPLES-01

  Example_1_Sesion_Simple:
    Ex: |
      ```
      Usuario: /sesion iniciar
      Agente:  âœ… Nueva sesiÃ³n creada: sesion-20260119-120000
               ğŸ“ Ruta: ~/.gemini/antigravity/sesiones/sesion-20260119-120000

      [... 30 minutos de trabajo ...]

      Usuario: Crea un snapshot
      Agente:  ğŸ“¸ Snapshot creado: _snapshot_20260119-123000.md

      [... mÃ¡s trabajo ...]

      Usuario: /sesion cerrar
      Agente:  ğŸ“¦ Generando handoff...
               âœ… Handoff creado: _handoff.md
      ```

  Example_2_Continuar_Sesion:
    Ex: |
      ```
      Usuario: /sesion estado
      Agente:  ğŸ“‚ Ãšltimas sesiones:
               - sesion-20260119-120000 (hace 2 horas)
               - sesion-20260118-150000 (ayer)

      Usuario: /sesion iniciar --continuar sesion-20260119-120000
      Agente:  ğŸ“– Cargando handoff...
               
               ## Objetivo Original
               DiseÃ±ar API de autenticaciÃ³n
               
               ## Estado Final
               JWT implementado, falta refresh tokens
               
               ## PrÃ³ximos Pasos
               - [ ] Implementar refresh tokens
               - [ ] Agregar logout
               
               Â¿Continuamos con refresh tokens?
      ```

  Example_3_Extraccion_Corpus:
    Ex: |
      ```
      Usuario: Necesito analizar este documento largo: @[spec.md]
      Agente:  ğŸ“„ Documento extenso detectado (2000 lÃ­neas)
               Ejecutando /extraccion-corpus...

               ğŸ“‹ Esqueleto generado:
               spec.md
               â”œâ”€â”€ Â§1 IntroducciÃ³n (1-50) - contexto
               â”œâ”€â”€ Â§2 AutenticaciÃ³n (51-300) - JWT, OAuth
               â”œâ”€â”€ Â§3 AutorizaciÃ³n (301-500) - RBAC
               â””â”€â”€ Â§4 AuditorÃ­a (501-700) - logs
               
               Integrado en _snapshot.md activo.
               
               Â¿QuÃ© secciÃ³n exploramos primero?
      ```

  Example_4_Sesion_Larga_Saturacion:
    Ex: |
      ```
      [DespuÃ©s de 1 hora de trabajo intenso]

      Agente:  âš ï¸ Contexto al 85%. Recomiendo snapshot.
               
      Usuario: Ok, haz snapshot
      Agente:  ğŸ“¸ Snapshot creado con esqueleto poblado.
               Contexto liberado. Continuemos.
      ```

File_Locations:
  ID: CTX-MGR-LOCATIONS-01
  Paths:
    Antigravity_Home: "~/.gemini/antigravity/"
    Project_Antigravity: "{proyecto}/.antigravity/"
  Tree: |
    ```
    ~/.gemini/antigravity/
    â”œâ”€â”€ skills/
    â”‚   â””â”€â”€ context-manager/           # Skill de gestiÃ³n
    â”‚       â”œâ”€â”€ SKILL.md
    â”‚       â””â”€â”€ templates/
    â”‚           â”œâ”€â”€ snapshot.md
    â”‚           â””â”€â”€ handoff.md
    â””â”€â”€ sesiones/
        â””â”€â”€ {session-id}/
            â”œâ”€â”€ _snapshot_*.md         # Capturas
            â””â”€â”€ _handoff.md            # Transferencia

    {proyecto}/.antigravity/
    â””â”€â”€ conocimiento/
        â””â”€â”€ dominio.md                 # Conocimiento del proyecto
    ```

Quick_Commands:
  ID: CTX-MGR-COMMANDS-01
  Commands:
    - Command: "/sesion iniciar"
      Act: "Nueva sesiÃ³n"
      Ref: DEF-SESIÃ“N-INICIAR
    - Command: "/sesion iniciar --continuar {id}"
      Act: "Continuar sesiÃ³n"
      Ref: DEF-SESIÃ“N-INICIAR-CONTINUAR
    - Command: "/sesion cerrar"
      Act: "Generar handoff"
      Ref: DEF-SESIÃ“N-CERRAR
    - Command: "/sesion estado"
      Act: "Ver sesiones"
      Ref: DEF-SESIÃ“N-ESTADO
    - Command: '"snapshot" o "guarda contexto"'
      Act: "Capturar estado"
      Ref: DEF-SNAPSHOT
    - Command: "/extraccion-corpus"
      Act: "Esqueleto de documento"
      Ref: DEF-EXTRACCION-CORPUS

Best_Practices:
  ID: CTX-MGR-BP-01
  Rec:
    - "Haz snapshots cada 30 minutos en sesiones largas."
    - "Al cerrar dÃ­a, siempre genera handoff."
    - "Crea `dominio.md` al iniciar proyecto nuevo."
    - "Usa esqueletos para documentos >500 lÃ­neas."
